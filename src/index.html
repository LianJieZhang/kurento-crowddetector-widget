<html>
<head>
	<meta content="charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="lib/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/styles.css">
	<link rel="stylesheet" href="bower_components/ekko-lightbox/dist/ekko-lightbox.min.css">

	<style type="text/css">
		body {
			margin: 0;
		}

		/*.container {
			max-width: 800px;
			height: 550px;
		}*/

		#myCanvas {
			position: absolute;
			z-index: 20;
			background-color: transparent;
		}

		video {
			position: absolute;
			width: 100%;
			height: 100%;
			z-index: 10;
		}

	</style>
</head>
<body>
	<!--<div class="container">-->
		<video id="v" autoplay muted loop src="http://techslides.com/demos/sample-videos/small.webm">
		</video>
		<canvas id="myCanvas">

		</canvas>
	<!--</div>-->
	<!--<button id="clear">Clear</button>-->
	<script>



	var canvas = document.getElementById("myCanvas");
	var video = document.getElementById("v");
	//var clear = document.getElementById("clear");
	//var container = document.getElementsByClassName("container")[0];
	var ctx = canvas.getContext("2d");
	var nDots = 0;
	var dots = [];
	var percDots = [];
	const MAX_DOTS = 4;


	function clearDots () {
		ctx.clearRect ( 0 , 0 , canvas.width, canvas.height );
		dots = [];
		percDots = [];
		nDots = 0;
	}

	function redraw (canvasPrev) {

		adjustDots(canvasPrev);

		for (var i=0; i<dots.length; i++) {
			ctx.beginPath();
			ctx.arc(dots[i][0], dots[i][1], 4, 0, 2 * Math.PI);
			ctx.fillStyle = "white";
			ctx.fill();
			ctx.stroke();
		}

		if (nDots > 1) {
			ctx.beginPath();
			ctx.lineWidth = 4;
			ctx.moveTo(dots[0][0], dots[0][1]);
			for (var i=1; i<dots.length; i++) {
				ctx.lineTo(dots[i][0], dots[i][1]);
			}
			if (nDots === 4) {
				ctx.closePath();
			}
			ctx.stroke();

			ctx.beginPath();
			ctx.lineWidth = 3;
			ctx.strokeStyle = "white";
			ctx.moveTo(dots[0][0], dots[0][1]);
			for (var i=1; i<dots.length; i++) {
				ctx.lineTo(dots[i][0], dots[i][1]);
			}
			if (nDots === 4) {
				ctx.closePath();
			}
			ctx.stroke();
		}
	}

	function adjustDots(canvasPrev) {
		for (var i=0; i<dots.length; i++) {
			dots[i][0] = dots[i][0]*canvas.width/canvasPrev.width;
			dots[i][1] = dots[i][1]*canvas.height/canvasPrev.height;
		}
	}

	function handler (e) {
		if (nDots >= 4) {
			return;
		}
		var coord = getCursorPosition(e);
		ctx.beginPath();
		ctx.arc(coord[0], coord[1], 4, 0, 2 * Math.PI);
		ctx.strokeStyle = "black";
		ctx.lineWidth = 1;
		ctx.fillStyle = "white";
		ctx.fill();
		ctx.stroke();
		dots.push(coord);
		nDots += 1;
		if (nDots > 1) {
			ctx.beginPath();
			ctx.lineWidth = 4;
			ctx.moveTo(dots[0][0], dots[0][1]);
			for (var i=1; i<dots.length; i++) {
				ctx.lineTo(dots[i][0], dots[i][1]);
			}
			if (nDots === 4) {
				ctx.closePath();
			}
			ctx.stroke();

			ctx.beginPath();
			ctx.lineWidth = 3;
			ctx.strokeStyle = "white";
			ctx.moveTo(dots[0][0], dots[0][1]);
			for (var i=1; i<dots.length; i++) {
				ctx.lineTo(dots[i][0], dots[i][1]);
			}
			if (nDots === 4) {
				ctx.closePath();
			}
			ctx.stroke();
		}
	}

	function getCursorPosition(e) {
		var rect = canvas.getBoundingClientRect(),
        	x = e.clientX - rect.left,
        	y = e.clientY - rect.top,
        	percX = e.offsetX/canvas.width,
        	percY = e.offsetY/canvas.height;
        percDots.push([percX, percY]);
        //console.log("Percentage position:\nX: " + e.offsetX/canvas.width + "\nY: " + e.offsetY/canvas.height)
		return [x,y];
	}

	function recalculate () {

		var videoWidth = video.videoWidth,
			videoHeight = video.videoHeight,
			clientWidth = video.clientWidth,
			clientHeight = video.clientHeight,
			videoRatio = videoWidth / videoHeight,
			windowRatio = window.innerWidth/window.innerHeight,
			canvasPrev = {width: canvas.width, height: canvas.height};


		canvas.style.left = 0 + 'px';
		canvas.style.top = 0 + 'px';
		// FORMULA: original height / original width x new width = new height
		// FORMULA: new width = new height * original width / originalheight

		if (windowRatio > videoRatio) {
			var canvasWidth = videoWidth * (clientHeight / videoHeight);
			canvas.width = canvasWidth;
			canvas.height = window.innerHeight;
			canvas.style.left = (clientWidth - canvasWidth) / 2 + 'px';
		} else {
			var canvasHeight = videoHeight * (clientWidth / videoWidth);
			canvas.height = canvasHeight;
			canvas.width = window.innerWidth;
			canvas.style.top = (clientHeight - canvasHeight) / 2 + 'px';
		}

		redraw(canvasPrev);
	}

	// function isPointInPoly(poly, pt){
	//     for(var c = false, i = -1, l = poly.length, j = l - 1; ++i < l; j = i){
	//         ((poly[i][1] <= pt[1] && pt[1] < poly[j][1] || (poly[j][1] <= pt[1] && pt[1] < poly[i][1])) 
	//         && (pt[0] < (poly[j][0] - poly[i][0]) * (pt[1] - poly[i][1]) / (poly[j][1] - poly[i][1]) + poly[i][0]) 
	//         && (c = !c)
	//     }
	//     return c;
	// }

	// function filler (e) {

	// 	if (nDots < 4) {
	// 		return;
	// 	}

	// 	var point = getCursorPosition(e);

	// 	ctx.beginPath();
	// 	ctx.lineWidth = 3;
	// 	ctx.strokeStyle = "white";
	// 	ctx.moveTo(dots[0][0], dots[0][1]);
	// 	for (var i=1; i<dots.length; i++) {
	// 		ctx.lineTo(dots[i][0], dots[i][1]);
	// 	}		
		

	// 	ctx.closePath();
	// 	//ctx.fill();
		



	// 	// if (isPointInPoly(dots, point)) {

	// 	// } else {

	// 	// }
	// }

	// function clearer (e) {
		
	// 	if (nDots < 4) {
	// 		return;
	// 	}

	// 	var point = getCursorPosition(e);

	// 	ctx.beginPath();
	// 	ctx.lineWidth = 3;
	// 	ctx.strokeStyle = "white";
	// 	ctx.moveTo(dots[0][0], dots[0][1]);
	// 	for (var i=1; i<dots.length; i++) {
	// 		ctx.lineTo(dots[i][0], dots[i][1]);
	// 	}		

	// 	ctx.closePath();
	// }


	window.addEventListener("resize", recalculate, false)
	canvas.addEventListener("click", handler, false);
	//clear.addEventListener("click", clearDots, false);
	video.addEventListener("resize", recalculate, false);

	</script> 


	<script src="lib/js/jquery.min.js"></script>
	<script src="lib/js/bootstrap.min.js"></script>
	<script src="lib/js/ekko-lightbox.min.js"></script>
	<script src="lib/js/adapter.js"></script>
	<script src="lib/js/kurento-utils.js"></script>
	<script src="js/index.js"></script>
</body>
</html>